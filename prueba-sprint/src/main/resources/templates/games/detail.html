<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${game.title} + ' - Grand Line'">Detalle del Juego</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <!-- Navbar Fragment -->
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <!-- Hero Section with Game Info -->
    <section class="gamer-hero-section" style="min-height: 60vh;">
        <div class="container h-100">
            <div class="row align-items-center h-100 py-5">
                <div class="col-lg-8">
                    <a href="/games" class="text-white text-decoration-none mb-3 d-inline-block">
                        <i class="fas fa-arrow-left me-2"></i>Volver a la lista
                    </a>
                    
                    <!-- Badge and Featured -->
                    <div class="mb-3">
                        <span class="badge me-2" 
                              th:if="${game.badge != null}"
                              th:style="'background-color: ' + ${game.badgeColor} + '; font-size: 1rem;'"
                              th:text="${game.badge}">
                            Badge
                        </span>
                        <span class="badge bg-warning" th:if="${game.isFeatured}" style="font-size: 1rem;">
                            <i class="fas fa-star"></i> Destacado
                        </span>
                    </div>

                    <!-- Title -->
                    <h1 class="display-3 fw-bold text-white mb-3" th:text="${game.title}">Game Title</h1>

                    <!-- Meta Info -->
                    <div class="d-flex flex-wrap gap-4 mb-4">
                        <div class="text-white" th:if="${game.rating != null}">
                            <i class="fas fa-star text-warning"></i>
                            <span class="fs-4 fw-bold ms-2" th:text="${game.rating} + '/10'">0/10</span>
                        </div>
                        <div class="text-white-50" th:if="${game.genre != null}">
                            <i class="fas fa-tag"></i>
                            <span class="ms-2" th:text="${game.genre}">Genre</span>
                        </div>
                        <div class="text-white-50" th:if="${game.releaseDate != null}">
                            <i class="fas fa-calendar"></i>
                            <span class="ms-2" th:text="${#temporals.format(game.releaseDate, 'dd/MM/yyyy')}">Date</span>
                        </div>
                    </div>

                    <!-- Description -->
                    <p class="lead text-white mb-4" th:text="${game.shortDescription}">Short description</p>

                    <!-- Action Buttons -->
                    <div class="d-flex gap-3 flex-wrap">
                        <button class="btn-gamer-primary" th:onclick="'downloadGame(' + ${game.id} + ')'">
                            <i class="fas fa-download me-2"></i>Descargar
                        </button>
                        <a th:href="@{/games/{id}/edit(id=${game.id})}" class="btn-gamer-outline">
                            <i class="fas fa-edit me-2"></i>Editar
                        </a>
                        <button class="btn btn-danger" data-bs-toggle="modal" th:data-bs-target="'#deleteModal'">
                            <i class="fas fa-trash me-2"></i>Eliminar
                        </button>
                    </div>
                </div>

                <!-- Game Image -->
                <div class="col-lg-4 text-center mt-4 mt-lg-0">
                    <div class="game-detail-image">
                        <img th:if="${game.coverImageUrl != null || game.thumbnailUrl != null}" 
                             th:src="${game.coverImageUrl != null ? game.coverImageUrl : game.thumbnailUrl}" 
                             alt="Game cover"
                             class="img-fluid rounded shadow-lg">
                        <i th:unless="${game.coverImageUrl != null || game.thumbnailUrl != null}" 
                           class="fas fa-gamepad fa-5x text-white-50"></i>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Game Details Section -->
    <section class="py-5" style="background: rgba(15, 23, 42, 0.5);">
        <div class="container">
            <div class="row g-4">
                <!-- Main Content -->
                <div class="col-lg-8">
                    <div class="glass-card p-4 mb-4">
                        <h2 class="h3 text-white mb-3">
                            <i class="fas fa-info-circle me-2"></i>Descripción
                        </h2>
                        <p class="text-white-50" th:text="${game.description}">Full description</p>
                    </div>

                    <!-- Trailer -->
                    <div class="glass-card p-4" th:if="${game.trailerUrl != null}">
                        <h2 class="h3 text-white mb-3">
                            <i class="fas fa-video me-2"></i>Tráiler
                        </h2>
                        <div class="ratio ratio-16x9">
                            <iframe th:src="${game.trailerUrl}" 
                                    allowfullscreen
                                    class="rounded"></iframe>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="col-lg-4">
                    <!-- Game Info Card -->
                    <div class="glass-card p-4 mb-4">
                        <h3 class="h5 text-white mb-3">
                            <i class="fas fa-gamepad me-2"></i>Información del Juego
                        </h3>
                        
                        <div class="info-item mb-3" th:if="${game.developer != null}">
                            <small class="text-white-50 d-block">Desarrollador</small>
                            <span class="text-white" th:text="${game.developer}">Developer</span>
                        </div>

                        <div class="info-item mb-3" th:if="${game.publisher != null}">
                            <small class="text-white-50 d-block">Editor</small>
                            <span class="text-white" th:text="${game.publisher}">Publisher</span>
                        </div>

                        <div class="info-item mb-3" th:if="${game.platforms != null}">
                            <small class="text-white-50 d-block">Plataformas</small>
                            <span class="text-white" th:text="${game.platforms}">Platforms</span>
                        </div>

                        <div class="info-item mb-3" th:if="${game.genre != null}">
                            <small class="text-white-50 d-block">Género</small>
                            <span class="text-white" th:text="${game.genre}">Genre</span>
                        </div>

                        <div class="info-item" th:if="${game.releaseDate != null}">
                            <small class="text-white-50 d-block">Fecha de lanzamiento</small>
                            <span class="text-white" th:text="${#temporals.format(game.releaseDate, 'dd MMMM yyyy')}">Date</span>
                        </div>
                    </div>

                    <!-- Stats Card -->
                    <div class="glass-card p-4">
                        <h3 class="h5 text-white mb-3">
                            <i class="fas fa-chart-bar me-2"></i>Estadísticas
                        </h3>
                        
                        <div class="stat-item mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="text-white-50">
                                    <i class="fas fa-eye me-2"></i>Visualizaciones
                                </span>
                                <span class="text-white fw-bold" th:text="${game.viewCount}">0</span>
                            </div>
                        </div>

                        <div class="stat-item mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="text-white-50">
                                    <i class="fas fa-download me-2"></i>Descargas
                                </span>
                                <span class="text-white fw-bold" id="downloadCount" th:text="${game.downloadCount}">0</span>
                            </div>
                        </div>

                        <div class="stat-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="text-white-50">
                                    <i class="fas fa-star me-2"></i>Calificación
                                </span>
                                <span class="text-warning fw-bold" th:text="${game.rating != null ? game.rating + '/10' : 'N/A'}">N/A</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Delete Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content glass-card">
                <div class="modal-header border-0">
                    <h5 class="modal-title text-white">
                        <i class="fas fa-exclamation-triangle text-danger me-2"></i>
                        Confirmar Eliminación
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-white">
                    ¿Estás seguro de eliminar el juego <strong th:text="${game.title}">Game</strong>?
                    Esta acción no se puede deshacer.
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn-gamer-outline" data-bs-dismiss="modal">Cancelar</button>
                    <form th:action="@{/games/{id}/delete(id=${game.id})}" method="post" class="d-inline">
                        <button type="submit" class="btn btn-danger">
                            <i class="fas fa-trash me-2"></i>Eliminar
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Fragment -->
    <div th:replace="~{fragments/footer :: footer}"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script th:inline="javascript">
        function downloadGame(gameId) {
            fetch('/games/' + gameId + '/download', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('downloadCount').textContent = data.downloads;
                    alert('¡Descarga iniciada! Contador actualizado.');
                }
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</body>
</html>
